---
title: "Hackerrank SQL"
author: "Joschka Schwarz"
output: 
  github_document:
    toc: true
    toc_depth: 1
---

```{r setup, include=FALSE}
library(RMariaDB)
con_cities <- dbConnect(
          drv      = RMariaDB::MariaDB(),
          dbname   = "hackerrank_cities",
          username = "jwarz",
          password = Sys.getenv("DB_PASS"), 
          host     = "localhost", 
          port     = 3306)

con_station <- dbConnect(
  drv      = RMariaDB::MariaDB(),
  dbname   = "hackerrank_station",
  username = "jwarz",
  password = Sys.getenv("DB_PASS"), 
  host     = "localhost", 
  port     = 3307)

knitr::opts_chunk$set(echo = TRUE, eval = T)
```

# SETUP

## Create User

```{sql, eval=F}
CREATE USER 'jwarz'@localhost IDENTIFIED BY '***';
GRANT ALL PRIVILEGES ON *.* TO 'jwarz'@localhost IDENTIFIED BY '***';
# GRANT ALL PRIVILEGES ON 'DBname'.* TO 'jwarz'@localhost; 
```

## Create databases

```{sql, eval=F}
DROP DATABASE IF EXISTS hackerrank_cities;
CREATE DATABASE hackerrank_cities;

DROP DATABASE IF EXISTS hackerrank_station;
CREATE DATABASE hackerrank_station;
# USE hackerrank_station;
```

## Create tables

```{sql, eval=F}
#########
# city1 #
#########
create table city1
(
    ID int primary key,
    NAME varchar(17),
    COUNTRYCODE varchar(3),
    DISTRICT varchar(20),
    POPULATION int
);

insert into city1 values (6, "Rotterdam", "NLD", "Zuid-Holland", 593321);
insert into city1 values (3878, "Scottsdale", "USA", "Arizona", 202705);
insert into city1 values (3965, "Corona", "USA", "California", 124966);
insert into city1 values (3973, "Concord", "USA", "California", 121780);
insert into city1 values (3977, "Cedar Rapids", "USA", "Iowa", 120758);
insert into city1 values (3982, "Coral Springs", "USA", "Florida", 117549);
insert into city1 values (4054, "Fairfield", "USA", "California", 92256);
insert into city1 values (4058, "Boulder", "USA", "Colorado", 91238);
insert into city1 values (4061, "Fall River", "USA", "Massachusetts", 90555);

#########
# city2 #
#########
create table city2
(
    ID int primary key,
    NAME varchar(17),
    COUNTRYCODE varchar(3),
    DISTRICT varchar(20),
    POPULATION int
);
LOAD DATA LOCAL INFILE "data/city2.csv" INTO TABLE city2
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
IGNORE 1 LINES;

###########
# STATION #
###########
create table STATION
(
    ID int,
    CITY varchar(21),
    STATE varchar(2),
    LAT_N decimal(10,0),
    LONG_W decimal(10,0)
);
LOAD DATA LOCAL INFILE "data/STATION.csv" INTO TABLE STATION
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
IGNORE 1 LINES;
```

# Basic Select

## City Data

The CITY1 / CITY2 tables are described as follows:

```{sql, connection=con_cities}
select column_name, column_type 
from INFORMATION_SCHEMA.COLUMNS 
where TABLE_NAME='city1';
```

## Revising the Select Query I

Query all columns for all American cities in the CITY table with populations larger than 100000. The CountryCode for America is USA.

```{sql, connection=con_cities}
SELECT *
FROM CITY1
WHERE POPULATION > 100000
AND COUNTRYCODE = "USA";
```

## Revising the Select Query II

Query the NAME field for all American cities in the CITY table with populations larger than 120000. The CountryCode for America is USA.

```{sql, connection=con_cities}
SELECT NAME
FROM CITY1
WHERE POPULATION > 120000
AND COUNTRYCODE = "USA";
```

## Select All

Query all columns (attributes) for every row in the CITY table.

```{sql, connection=con_cities}
SELECT *
FROM city1;
```

## Select BY ID

*Table: CITY2*

Query all columns for a city in CITY with the ID 1661.

```{sql, connection=con_cities}
SELECT * 
FROM CITY2
WHERE ID = 1661; 
```

## Japanese Cities' Attributes

Query all attributes of every Japanese city in the CITY table. The COUNTRYCODE for Japan is JPN.

```{sql, connection=con_cities}
SELECT * 
FROM CITY2 
WHERE COUNTRYCODE = 'JPN';        
```

## Japanese Cities' Names

Query the names of all the Japanese cities in the CITY table. The COUNTRYCODE for Japan is JPN. 

```{sql, connection=con_cities}
SELECT NAME 
FROM CITY2 
WHERE COUNTRYCODE = 'JPN';              
```

## Weather Observation Station data

The STATION table is described as follows:

```{sql, connection=con_station}
select column_name, column_type 
from INFORMATION_SCHEMA.COLUMNS 
where TABLE_NAME='STATION';
```

## Weather Observation Station 1

*SIMPLE SELECT*

Query a list of CITY and STATE from the STATION table. 

```{sql, connection=con_station}
SELECT CITY, STATE 
FROM STATION;
```

## Weather Observation Station 2

Does not exist ...

## Weather Observation Station 3

*MODULO*

Query a list of CITY names from STATION with even ID numbers only. You may print the results in any order, but must exclude duplicates from your answer.

```{sql, connection=con_station}
SELECT DISTINCT CITY
FROM STATION
WHERE MOD(ID,2)=0
ORDER BY CITY ASC;  
```

## Weather Observation Station 4

*MATH INSIDE SELECT*

Find the difference between the total number of CITY entries in the table and the number of distinct CITY entries in the table. 

```{sql, connection=con_station}
select (count(CITY) - count(distinct CITY))
from STATION; 
```

## Weather Observation Station 5

*STRINGLENGTH*
*ORDER BY*
*LIMIT*

Query the two cities in STATION with the shortest and longest CITY names, as well as their respective lengths (i.e.: number of characters in the name). If there is more than one smallest or largest city, choose the one that comes first when ordered alphabetically.

**Note** 
You can write two separate queries to get the desired output. It need not be a single query.

```{sql, connection=con_station}
(SELECT CITY, LENGTH(CITY) AS length FROM STATION ORDER BY length ASC, CITY ASC LIMIT 1 ) 
UNION 
(SELECT CITY, LENGTH(CITY) AS length FROM STATION ORDER BY length DESC, CITY ASC LIMIT 1 );
```

## Weather Observation Station 6

*SUBSTRING CONDITION (FIRST LETTER)*

Query the list of CITY names starting with vowels (i.e., a, e, i, o, or u) from STATION. Your result cannot contain duplicates.

**1. MySQL** 

* RLIKE

```{sql, connection=con_station}
SELECT DISTINCT(city) 
FROM station 
WHERE city RLIKE '^[aeiou]';
```

* REGEXP

```{sql, eval=F}
SELECT DISTINCT CITY 
FROM STATION  
WHERE CITY REGEXP '^[aeiou]';
```

* SUBSTRING & IN

```{sql, eval=F}
SELECT DISTINCT(CITY)
FROM STATION 
WHERE LOWER(SUBSTR(CITY, 1,1)) in ('a','e','i','o','u');
```

* LEFT,RIGHT & IN

```{sql, eval=F}
SELECT DISTINCT CITY
FROM STATION
WHERE LOWER(LEFT(CITY,1)) IN ('a', 'e', 'i', 'o', 'u');
```

**2. MS SQL Server**

```{sql, eval = F}
# MS SQL SERVER
SELECT DISTINCT city 
from station 
where city LIKE '[a, e, i, o, u]%';
```

## Weather Observation Station 7

*SUBSTRING CONDITION (LAST LETTER)*

Query the list of CITY names ending with vowels (a, e, i, o, u) from STATION. Your result cannot contain duplicates.

1. MySQL

* RLIKE

```{sql, connection=con_station}
SELECT DISTINCT(city) 
FROM station 
WHERE city RLIKE '[aeiou]$';
```

* REGEXP

```{sql, eval = F}
SELECT DISTINCT CITY 
FROM STATION  
WHERE CITY REGEXP '[aeiou]$';
```

* SUBSTRING & IN

```{sql, eval = F}
select distinct(CITY) from STATION 
where LOWER(SUBSTR(CITY, -1)) in ('a','e','i','o','u');
```

* LEFT,RIGHT & IN

```{sql, eval = F}
SELECT DISTINCT CITY
FROM STATION
WHERE LOWER(RIGHT(CITY,1)) IN ('a', 'e', 'i', 'o', 'u');
```

**2. MS SQL Server**

```{sql, eval = F}
# MS SQL SERVER
SELECT DISTINCT city 
from station 
where city LIKE '%[a, e, i, o, u]';
```

## Weather Observation Station 8

*SUBSTRING CONDITION (FIRST AND LAST LETTER)*

Query the list of CITY names from STATION which have vowels (i.e., a, e, i, o, and u) as both their first and last characters. Your result cannot contain duplicates.

**1. MySQL**

* RLIKE

```{sql, connection=con_station}
SELECT DISTINCT(city) 
FROM station 
WHERE city RLIKE '^[aeiou]' AND city RLIKE '[aeiou]$';
```

* REGEXP

```{sql, eval = F}
SELECT DISTINCT CITY 
FROM STATION  
WHERE CITY REGEXP '^[aeiou]' AND CITY REGEXP '[aeiou]$';
```

* SUBSTRING & IN

```{sql, eval = F}
select distinct(CITY) from STATION 
where LOWER(SUBSTR(CITY, -1)) in ('a','e','i','o','u') 
      and LOWER(SUBSTR(CITY, 1,1)) in ('a','e','i','o','u');
```

* LEFT,RIGHT & IN

```{sql, eval = F}
SELECT DISTINCT CITY
FROM STATION
WHERE LOWER(LEFT(CITY,1)) IN ('a', 'e', 'i', 'o', 'u') AND
      LOWER(RIGHT(CITY,1)) IN ('a', 'e', 'i', 'o', 'u');
```

**2. MS SQL Server**

```{sql, eval = F}
# MS SQL SERVER
SELECT DISTINCT city 
from station 
where city LIKE '[a, e, i, o, u]%[a, e, i, o, u]';
```

## Weather Observation Station 9

*SUBSTRING CONDITION (NEGATE FIRST LETTER)*

Query the list of CITY names from STATION that do not start with vowels. Your result cannot contain duplicates.

**1. MySQL** 

* RLIKE

```{sql, connection=con_station}
SELECT DISTINCT(city) 
FROM station 
WHERE city NOT RLIKE '^[aeiou]';
```

* REGEXP

```{sql, eval=F}
SELECT DISTINCT CITY 
FROM STATION  
WHERE CITY NOT REGEXP '^[aeiou]';
```

* SUBSTRING & IN

```{sql, eval=F}
SELECT DISTINCT(CITY)
FROM STATION 
WHERE LOWER(SUBSTR(CITY, 1,1)) not in ('a','e','i','o','u');
```

* LEFT,RIGHT & IN

```{sql, eval=F}
SELECT DISTINCT CITY
FROM STATION
WHERE LOWER(LEFT(CITY,1)) NOT IN ('a', 'e', 'i', 'o', 'u');
```

**2. MS SQL Server**

```{sql, eval = F}
# MS SQL SERVER
SELECT DISTINCT city 
from station 
where city NOT LIKE '[a, e, i, o, u]%';
```

## Weather Observation Station 10

*SUBSTRING CONDITION (NEGATE LAST LETTER)*

Query the list of CITY names from STATION that do not end with vowels. Your result cannot contain duplicates.

**1. MySQL** 

* RLIKE

```{sql, connection=con_station}
SELECT DISTINCT(city) 
FROM station 
WHERE city NOT RLIKE '[aeiou]$';
```

...

## Weather Observation Station 11

*SUBSTRING CONDITION (NEGATE & OR)*

Query the list of CITY names from STATION that either do not start with vowels or do not end with vowels. Your result cannot contain duplicates.

```{sql, connection=con_station}
SELECT DISTINCT(city) 
FROM station 
WHERE city NOT RLIKE '^[aeiou]' OR city NOT RLIKE '[aeiou]$';
```

...

## Weather Observation Station 12

*SUBSTRING CONDITION (NEGATE & AND)*

Query the list of CITY names from STATION that do not start with vowels and do not end with vowels. Your result cannot contain duplicates.

```{sql, connection=con_station}
SELECT DISTINCT(city) 
FROM station 
WHERE city NOT RLIKE '^[aeiou]' AND city NOT RLIKE '[aeiou]$';
```


# Advanced Select

coming soon ...

# Aggregation

coming soon ...

# Basic Join

coming soon ...

# Advanced Join

coming soon ...

# Alternative Queries

coming soon ...